/*! company 罗格斯达 version 1.0.0 2015-06-17 */
define("widget/form/ajaxForm2",["../../lib/http/request","../../lib/http/bodyParse"],function(e,t,r){function i(e){this.oWrap=e.oWrap||null,this.oSub=e.oSub||null,this.subUrl=e.subUrl||null,this.otherJude=e.otherJude||null,this.fnSumbit=e.fnSumbit||null,this.sucDo=e.sucDo||null,this.failDo=e.failDo||null,this.noSub=e.noSub||null}var n=e("../../lib/http/request"),o=e("../../lib/http/bodyParse");e("../../../css/widget/form/ajaxForm.css"),i.prototype={init:function(){this.events()},events:function(){var e=this;this.oWrap.on("focus","input[type = text], textarea",function(t){e.check($(this),t)}),this.oWrap.on("blur","input[type = text], textarea",function(t){e.check($(this),t)}),this.oWrap.on("click","input[type = radio]",function(t){e.check($(this),t)}),this.oWrap.on("click","input[type = checkbox]",function(t){e.check($(this),t)}),this.oWrap.on("change","select",function(t){e.check($(this),t)})},check:function(e){{e.attr("isCheck")?e.attr("isCheck"):"yes",void 0!=e.attr("reg")}},makeTip:function(e){var t;t=e.attr("hasMaked"),"yes"!==t&&e.attr("hasMaked","yes")},makeWrapTip1:function(e){if("true"==e.attr("ischeck")||"free"==e.attr("ischeck")){e.parent().css({position:"relative"});var t=$('<span class="wrong_area" script-role="wrong_area"></span>'),r='<span class="wrong_content" script-role="wrong_name" script-role="wrong_name"></span><span class="wrrong_bot"></span>';t.html(r),e.before(t),this.tipPosition(e,t)}},tipPosition:function(e,t){var r=e.position().left;e.innerWidth();var i=r,n=e.outerHeight(!0)-1+e.position().top;(e.attr("checkbox_group")||"checkbox"==e.attr("type"))&&(n+=10),t.css({position:"absolute",left:i,top:n,zIndex:1e3})},tipWrong:function(e,t,r){t.find("[script-role = wrong_name]").html(r),this.tipPosition(e,t),setTimeout(function(){t.addClass("wrong")},0),t.attr("iswrong","true"),e.parents("[script-role = check_wrap]").addClass("has-error")},tipRight:function(e,t){t.removeClass("wrong"),t.attr("iswrong","false"),e.parents("[script-role = check_wrap]").removeClass("has-error")},checkText:function(e){var t,r;if(r=this,e.attr("pressUrl")){var i=o().pid;e.keyup(function(){r.pressInput($(this),i)}),e.blur(function(){r.pressInput($(this),i)})}else e.blur(function(){r.inputJude($(this))});e.focus(function(){t=$(this).parent().find("[script-role = wrong_area]"),r.tipRight(e,t)})},pressInput:function(e,t){var r=this;dataJson={},oTip=e.parent().find("[script-role = wrong_area]"),pressUrl=e.attr("pressUrl"),param=e.attr("param"),dataJson[param]=e.val(),dataJson.pid=t;var i=e;n({url:pressUrl,data:dataJson,sucDo:function(){r.tipRight(e,oTip)},noDataDo:function(e){r.tipWrong(i,oTip,e)}})},inputJude:function(e){var t,r,i,n,a,s;if(s=this,e.attr("pressUrl")){var c=o().pid;s.pressInput(e,c)}else t=e.parent().find("[script-role = wrong_area]"),r=e.attr("tip"),i=e.attr("wrong"),n=RegExp("^"+e.attr("re")+"$","gi"),a=e.val(),"true"==e.attr("ischeck")?e.val()?n.test(a)?s.tipRight(e,t):s.tipWrong(e,t,i):s.tipWrong(e,t,r):"free"==e.attr("ischeck")?""!=a&&(n.test(a)?s.tipRight(e,t):s.tipWrong(e,t,i)):a&&(n.test(a)?s.tipRight(e,t):s.tipWrong(e,t,i))},checkSelect:function(e){var t;t=this,e.change(function(){t.selectJude($(this))})},selectJude:function(e){if("true"==e.attr("ischeck")||"free"==e.attr("ischeck")){var t,r;t=e.parent().find("[script-role = wrong_area]"),r=e.attr("tip"),e.val()?this.tipRight(e,t):this.tipWrong(e,t,r)}},checkRadio:function(e){var t=this;e.click(function(){t.radioJudge(e)})},radioJudge:function(e){var t=e.find("input[type = radio]"),r=!1,i=e.parent().find("[script-role = wrong_area]"),n=e.attr("tip");t.each(function(e){t.eq(e).attr("checked")&&(r=!0)}),("true"==e.attr("ischeck")||"free"==e.attr("ischeck"))&&(r?this.tipRight(e,i):this.tipWrong(e,i,n))},checkBox:function(e){var t=this;e.click(function(){t.checkJudge(e)})},checkJudge:function(e){var t=e.find("input[type = checkbox]"),r=!1,i=e.parent().find("[script-role = wrong_area]"),n=e.attr("tip");t.each(function(e){t.eq(e).attr("checked")&&(r=!0)}),("true"==e.attr("ischeck")||"free"==e.attr("ischeck"))&&(r?this.tipRight(e,i):this.tipWrong(t.eq(0),i,n))},checkother:function(e){var t=this,r=e.attr("name");e.attr("tip");var i,n=e.attr("tip"),o=e.attr("wrong");this.oSub.click(function(){i=e.parent().find("[script-role = wrong_area]"),t.otherCheck[r][0](e)?t.otherCheck[r][1](e)?t.otherCheck[r][0](e)&&t.otherCheck[r][1](e)&&t.tipRight(e,i):t.tipWrong(e,i,o):t.tipWrong(e,i,n)})},subMitEvent:function(){var e=this;this.oSub.click(function(){e.subMit()})},subMit:function(){var e,t;if(e=this.oWrap.find("[script-role = wrong_area]"),t=!0,this.map(this.arrSelect,function(e){this.selectJude(this.arrSelect[e])}),this.map(this.arrInput,function(e){this.inputJude(this.arrInput[e])}),this.map(this.arrRadio,function(e){this.radioJudge(this.arrRadio[e])}),this.map(this.arrcheckBox,function(e){this.checkJudge(this.arrcheckBox[e])}),e.each(function(r){"true"==e.eq(r).attr("iswrong")&&(t=!1)}),t)if(this.otherJude){var r=!0;if(this.map(this.otherJude,function(e){this.otherJude[e]()||(r=!1)}),!r)return;this.getAllData()}else this.getAllData()},map:function(e,t){var r,i;for(i=e.length,r=0;i>r;r++)t.call(this,r)},getAllParam:function(){var e=this;return this.getInputData(this.arrInput),this.getSelectData(this.arrSelect),this.map(this.arrRadio,function(t){e.getRadioData(e.arrRadio[t])}),this.param},getAllData:function(){var e=this;if(this.getAllParam(),this.map(this.arrcheckBox,function(t){e.getCheckData(e.arrcheckBox[t])}),this.noSub)return this.noSub(),void 0;if(this.fnSumbit){var t=this.fnSumbit(this.param);this.param={};for(key in t)this.param[key]=t[key]}n({url:this.subUrl,data:this.param,beforeDo:function(){e.loadingShow()},sucDo:function(t){e.loadingHide(),e.sucDo&&e.sucDo(t)},noDataDo:function(t){e.loadingHide(),e.failDo&&e.failDo(t)}})},getInputData:function(e){var t=this;this.map(e,function(r){"false"!=e[r].attr("no_upload")&&("free"!=e[r].attr("ischeck")||e[r].val())&&(t.param[e[r].attr("name")]=e[r].val())})},getSelectData:function(e){var t=this;this.map(e,function(r){"false"!=e[r].attr("no_upload")&&("free"!=e[r].attr("ischeck")||e[r].val())&&(t.param[e[r].attr("name")]=e[r].get(0).children[e[r].get(0).selectedIndex].id)})},getRadioData:function(e){if("false"!=e.attr("no_upload")){var t=e.find("input[type = radio]"),r=e.attr("name"),i="";t.each(function(e){"checked"==t.eq(e).attr("checked")&&(i=t.eq(e).val())}),this.param[r]=i}},getCheckData:function(e){if("false"!=e.attr("no_upload")){var t=e.find("input[type = checkbox]"),r=e.attr("name"),i=[];t.each(function(e){"checked"==t.eq(e).attr("checked")&&i.push(t.eq(e).attr("id"))}),this.param[r]=i.join(",")}},makeLoading:function(e){var t,r,i,n;return i=$("<img src="+this.loaddingUrl+' width="16" height="16">'),n=e.attr("offsetLoad")?parseInt(e.attr("offsetLoad")):this.loadOffset,e.css({position:"relative"}),t=Math.floor((e.outerWidth()-16)/2-n),r=Math.floor((e.outerHeight()-16)/2),i.css({position:"absolute",left:t+"px",top:r+"px",zIndex:2,display:"none"}),e.append(i),i},loadingShow:function(){this.oSub.addClass("disabled"),this.oSub.attr("disabled","disabled")},loadingHide:function(){this.oSub.removeClass("disabled"),this.oSub.removeAttr("disabled")},clear:function(){var e=this;this.map(this.arrSelect,function(t){e.arrSelect[t][0].selectedIndex=0}),this.oWrap.find("[form_check]").val(""),this.map(this.arrRadio,function(){e.arrRadio.removeAttr("checked")}),this.map(this.arrcheckBox,function(){e.arrcheckBox.removeAttr("checked")})}},r.exports=i});