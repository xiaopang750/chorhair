/*! company 罗格斯达 version 1.0.0 2015-06-17 */
define("widget/form/tree",["../../lib/http/loadCss"],function(e,t,r){function i(e,t,r,i,n,o,a,s,c){this.id=e,this.pid=t,this.name=r,this.url=i,this.title=n,this.target=o,this.icon=a,this.iconOpen=s,this._io=c||!1,this._is=!1,this._ls=!1,this._hc=!1,this._ai=0,this._p}function n(e){this.config={target:null,folderLinks:!0,useSelection:!0,useCookies:!0,useLines:!0,useIcons:!0,useStatusText:!1,closeSameLevel:!1,inOrder:!1},this.icon={root:R.uri.assets+"lib/widget/tree/blank.gif",folder:R.uri.assets+"lib/widget/tree/blank.gif",folderOpen:R.uri.assets+"lib/widget/tree/blank.gif",node:R.uri.assets+"lib/widget/tree/blank.gif",empty:R.uri.assets+"lib/widget/tree/empty.gif",line:R.uri.assets+"lib/widget/tree/line.gif",join:R.uri.assets+"lib/widget/tree/join.gif",joinBottom:R.uri.assets+"lib/widget/tree/joinbottom.gif",plus:R.uri.assets+"lib/widget/tree/plus.gif",plusBottom:R.uri.assets+"lib/widget/tree/plusbottom.gif",minus:R.uri.assets+"lib/widget/tree/minus.gif",minusBottom:R.uri.assets+"lib/widget/tree/minusbottom.gif",nlPlus:R.uri.assets+"lib/widget/tree/nolines_plus.gif",nlMinus:R.uri.assets+"lib/widget/tree/nolines_minus.gif"},this.obj=e,this.aNodes=[],this.aIndent=[],this.root=new i(-1),this.selectedNode=null,this.selectedFound=!1,this.completed=!1}var o=e("../../lib/http/loadCss");o(R.uri.css+"widget/form/tree.css"),n.prototype.add=function(e,t,r,n,o,a,s,c,l){this.aNodes[this.aNodes.length]=new i(e,t,r,n,o,a,s,c,l)},n.prototype.openAll=function(){this.oAll(!0)},n.prototype.closeAll=function(){this.oAll(!1)},n.prototype.toString=function(){var e='<div class="dtree">\n';return document.getElementById?(this.config.useCookies&&(this.selectedNode=this.getSelected()),e+=this.addNode(this.root)):e+="Browser not supported.",e+="</div>",this.selectedFound||(this.selectedNode=null),this.completed=!0,e},n.prototype.addNode=function(e){var t="",r=0;for(this.config.inOrder&&(r=e._ai),r;this.aNodes.length>r;r++)if(this.aNodes[r].pid==e.id){var i=this.aNodes[r];if(i._p=e,i._ai=r,this.setCS(i),!i.target&&this.config.target&&(i.target=this.config.target),i._hc&&!i._io&&this.config.useCookies&&(i._io=this.isOpen(i.id)),!this.config.folderLinks&&i._hc&&(i.url=null),this.config.useSelection&&i.id==this.selectedNode&&!this.selectedFound&&(i._is=!0,this.selectedNode=r,this.selectedFound=!0),t+=this.node(i,r),i._ls)break}return t},n.prototype.node=function(e,t){var r='<div class="dTreeNode">'+this.indent(e,t);return this.config.useIcons&&(e.icon||(e.icon=this.root.id==e.pid?this.icon.root:e._hc?this.icon.folder:this.icon.node),e.iconOpen||(e.iconOpen=e._hc?this.icon.folderOpen:this.icon.node),this.root.id==e.pid&&(e.icon=this.icon.root,e.iconOpen=this.icon.root),r+='<img id="i'+this.obj+t+'" src="'+(e._io?e.iconOpen:e.icon)+'" alt="" />'),e.url?(r+='<a id="s'+this.obj+t+'" class="'+(this.config.useSelection?e._is?"nodeSel":"node":"node")+'" href="'+e.url+'"',e.title&&(r+=' title="'+e.title+'"'),e.target&&(r+=' target="'+e.target+'"'),this.config.useStatusText&&(r+=" onmouseover=\"window.status='"+e.name+"';return true;\" onmouseout=\"window.status='';return true;\" "),this.config.useSelection&&(e._hc&&this.config.folderLinks||!e._hc)&&(r+=' onclick="javascript: '+this.obj+".s("+t+');"'),r+=">"):this.config.folderLinks&&e.url||!e._hc||e.pid==this.root.id||(r+='<a href="javascript: '+this.obj+".o("+t+');" class="node">'),r+=e.name,(e.url||(!this.config.folderLinks||!e.url)&&e._hc)&&(r+="</a>"),r+="</div>",e._hc&&(r+='<div id="d'+this.obj+t+'" class="clip" style="display:'+(this.root.id==e.pid||e._io?"block":"none")+';">',r+=this.addNode(e),r+="</div>"),this.aIndent.pop(),r},n.prototype.indent=function(e,t){var r="";if(this.root.id!=e.pid){for(var i=0;this.aIndent.length>i;i++)r+='<img src="'+(1==this.aIndent[i]&&this.config.useLines?this.icon.line:this.icon.empty)+'" alt="" />';e._ls?this.aIndent.push(0):this.aIndent.push(1),e._hc?(r+='<a href="javascript: '+this.obj+".o("+t+');"><img id="j'+this.obj+t+'" src="',r+=this.config.useLines?e._io?e._ls&&this.config.useLines?this.icon.minusBottom:this.icon.minus:e._ls&&this.config.useLines?this.icon.plusBottom:this.icon.plus:e._io?this.icon.nlMinus:this.icon.nlPlus,r+='" alt="" /></a>'):r+='<img src="'+(this.config.useLines?e._ls?this.icon.joinBottom:this.icon.join:this.icon.empty)+'" alt="" />'}return r},n.prototype.setCS=function(e){for(var t,r=0;this.aNodes.length>r;r++)this.aNodes[r].pid==e.id&&(e._hc=!0),this.aNodes[r].pid==e.pid&&(t=this.aNodes[r].id);t==e.id&&(e._ls=!0)},n.prototype.getSelected=function(){var e=this.getCookie("cs"+this.obj);return e?e:null},n.prototype.s=function(e){if(this.config.useSelection){var t=this.aNodes[e];(!t._hc||this.config.folderLinks)&&this.selectedNode!=e&&((this.selectedNode||0==this.selectedNode)&&(eOld=document.getElementById("s"+this.obj+this.selectedNode),eOld.className="node"),eNew=document.getElementById("s"+this.obj+e),eNew.className="nodeSel",this.selectedNode=e,this.config.useCookies&&this.setCookie("cs"+this.obj,t.id))}},n.prototype.o=function(e){var t=this.aNodes[e];this.nodeStatus(!t._io,e,t._ls),t._io=!t._io,this.config.closeSameLevel&&this.closeLevel(t),this.config.useCookies&&this.updateCookie()},n.prototype.oAll=function(e){for(var t=0;this.aNodes.length>t;t++)this.aNodes[t]._hc&&this.aNodes[t].pid!=this.root.id&&(this.nodeStatus(e,t,this.aNodes[t]._ls),this.aNodes[t]._io=e);this.config.useCookies&&this.updateCookie()},n.prototype.openTo=function(e,t,r){if(!r)for(var i=0;this.aNodes.length>i;i++)if(this.aNodes[i].id==e){e=i;break}var n=this.aNodes[e];n.pid!=this.root.id&&n._p&&(n._io=!0,n._is=t,this.completed&&n._hc&&this.nodeStatus(!0,n._ai,n._ls),this.completed&&t?this.s(n._ai):t&&(this._sn=n._ai),this.openTo(n._p._ai,!1,!0))},n.prototype.closeLevel=function(e){for(var t=0;this.aNodes.length>t;t++)this.aNodes[t].pid==e.pid&&this.aNodes[t].id!=e.id&&this.aNodes[t]._hc&&(this.nodeStatus(!1,t,this.aNodes[t]._ls),this.aNodes[t]._io=!1,this.closeAllChildren(this.aNodes[t]))},n.prototype.closeAllChildren=function(e){for(var t=0;this.aNodes.length>t;t++)this.aNodes[t].pid==e.id&&this.aNodes[t]._hc&&(this.aNodes[t]._io&&this.nodeStatus(!1,t,this.aNodes[t]._ls),this.aNodes[t]._io=!1,this.closeAllChildren(this.aNodes[t]))},n.prototype.nodeStatus=function(e,t,r){eDiv=document.getElementById("d"+this.obj+t),eJoin=document.getElementById("j"+this.obj+t),this.config.useIcons&&(eIcon=document.getElementById("i"+this.obj+t),eIcon.src=e?this.aNodes[t].iconOpen:this.aNodes[t].icon),eJoin.src=this.config.useLines?e?r?this.icon.minusBottom:this.icon.minus:r?this.icon.plusBottom:this.icon.plus:e?this.icon.nlMinus:this.icon.nlPlus,eDiv.style.display=e?"block":"none"},n.prototype.clearCookie=function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("co"+this.obj,"cookieValue",t),this.setCookie("cs"+this.obj,"cookieValue",t)},n.prototype.setCookie=function(e,t,r,i,n,o){document.cookie=escape(e)+"="+escape(t)+(r?"; expires="+r.toGMTString():"")+(i?"; path="+i:"")+(n?"; domain="+n:"")+(o?"; secure":"")},n.prototype.getCookie=function(e){var t="",r=document.cookie.indexOf(escape(e)+"=");if(-1!=r){var i=r+(escape(e)+"=").length,n=document.cookie.indexOf(";",i);t=-1!=n?unescape(document.cookie.substring(i,n)):unescape(document.cookie.substring(i))}return t},n.prototype.updateCookie=function(){for(var e="",t=0;this.aNodes.length>t;t++)this.aNodes[t]._io&&this.aNodes[t].pid!=this.root.id&&(e&&(e+="."),e+=this.aNodes[t].id);this.setCookie("co"+this.obj,e)},n.prototype.isOpen=function(e){for(var t=this.getCookie("co"+this.obj).split("."),r=0;t.length>r;r++)if(t[r]==e)return!0;return!1},Array.prototype.push||(Array.prototype.push=function(){for(var e=0;arguments.length>e;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.pop||(Array.prototype.pop=function(){return lastElement=this[this.length-1],this.length=Math.max(this.length-1,0),lastElement}),r.exports=n});